import{B as de,C as A,E as N,F as j,a as ie,c as oe,d as O,e as re,l as T,n as F,p as ae,q as D,r as z,s as le,t as se,v as ce,x as V,y as L}from"./chunk-6XGMAUUD.js";import"./chunk-NODAZ5ET.js";import"./chunk-QUJFQN2Y.js";import"./chunk-U2EW7UUI.js";import"./chunk-3VGDWX6T.js";import"./chunk-TPX2NT44.js";import"./chunk-PESUVOSL.js";import{a as x}from"./chunk-BZW6RTSU.js";import{$ as v,D as B,F as M,G as i,H as o,I as R,J as W,K as H,M as U,N as g,O as f,V as q,W as r,X as h,Z as J,_ as w,aa as I,ca as y,ia as G,j as P,nb as Q,oa as K,ob as X,pb as Y,q as _,qb as Z,r as b,ra as E,rb as ee,sa as C,ua as S,x as $,xb as te,y as p,yb as k,z as u,zb as ne}from"./chunk-Q3SEP6DO.js";import"./chunk-O2LKDVXV.js";import"./chunk-UVK64YLH.js";import"./chunk-6IHAYORV.js";import"./chunk-3OY46VXU.js";import"./chunk-BD6LD5VO.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-YP6DMM4G.js";import"./chunk-CKP3SGE2.js";import"./chunk-HS6F7JI3.js";import"./chunk-NQVRKVPL.js";import"./chunk-NTF5CPGF.js";import"./chunk-DLTAMAIO.js";import"./chunk-K6FI7DQH.js";import"./chunk-TLQMGTG2.js";import"./chunk-M2X7KQLB.js";import"./chunk-LRFGNCHE.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{e as m}from"./chunk-FP7EQKGB.js";var me=(()=>{let s=class s{constructor(t,e,n){this.modalCtrl=t,this.http=e,this.toastCtrl=n,this.nombre="",this.apellido="",this.numero="",this.imagen=null,this.imagenPreview=""}ngOnInit(){this.nombre=this.usuario?.nombre||"",this.apellido=this.usuario?.apellido||"",this.numero=this.usuario?.numero||"",this.imagenPreview=this.usuario?.imagenUrl||""}cerrar(){this.modalCtrl.dismiss()}onImageChange(t){let e=t.target.files[0];if(e){this.imagen=e;let n=new FileReader;n.onload=()=>{this.imagenPreview=n.result},n.readAsDataURL(e)}}guardarCambios(){return m(this,null,function*(){let t=localStorage.getItem("token"),e=new C().set("Authorization",`Bearer ${t}`),n=new FormData;n.append("nombre",this.nombre),n.append("apellido",this.apellido),n.append("numero",this.numero),this.imagen&&n.append("imagen",this.imagen),this.http.put(`${x}/travel/usuarios/perfil`,n,{headers:e}).subscribe({next:()=>m(this,null,function*(){(yield this.toastCtrl.create({message:"Perfil actualizado correctamente",duration:2e3,color:"success"})).present(),this.modalCtrl.dismiss(!0)}),error:d=>m(this,null,function*(){(yield this.toastCtrl.create({message:d.error?.msg||"Error al actualizar perfil",duration:2e3,color:"danger"})).present()})})})}};s.\u0275fac=function(e){return new(e||s)(u(A),u(S),u(N))},s.\u0275cmp=P({type:s,selectors:[["app-editar-perfil"]],inputs:{usuario:"usuario"},standalone:!0,features:[y],decls:23,vars:3,consts:[["color","primary"],["slot","end"],["fill","clear",3,"click"],[1,"ion-padding","editar-perfil-content"],["novalidate","",3,"submit"],["position","floating","color","primary"],["name","nombre","required","",3,"ngModelChange","ngModel"],["name","apellido","required","",3,"ngModelChange","ngModel"],["name","numero","type","tel","required","",3,"ngModelChange","ngModel"],["type","submit","expand","block",1,"ion-margin-top","guardar-btn"]],template:function(e,n){e&1&&(i(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),r(3,"Editar Perfil"),o(),i(4,"ion-buttons",1)(5,"ion-button",2),g("click",function(){return n.cerrar()}),r(6,"Cerrar"),o()()()(),i(7,"ion-content",3)(8,"form",4),g("submit",function(){return n.guardarCambios()}),i(9,"ion-item")(10,"ion-label",5),r(11,"Nombre"),o(),i(12,"ion-input",6),I("ngModelChange",function(a){return v(n.nombre,a)||(n.nombre=a),a}),o()(),i(13,"ion-item")(14,"ion-label",5),r(15,"Apellido"),o(),i(16,"ion-input",7),I("ngModelChange",function(a){return v(n.apellido,a)||(n.apellido=a),a}),o()(),i(17,"ion-item")(18,"ion-label",5),r(19,"N\xFAmero"),o(),i(20,"ion-input",8),I("ngModelChange",function(a){return v(n.numero,a)||(n.numero=a),a}),o()(),i(21,"ion-button",9),r(22," Guardar Cambios "),o()()()),e&2&&(p(12),w("ngModel",n.nombre),p(4),w("ngModel",n.apellido),p(4),w("ngModel",n.numero))},dependencies:[E,k,ee,Q,X,te,Z,Y,j,O,re,T,F,ae,D,z,V,L,ie],styles:['@charset "UTF-8";.editar-perfil-content[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background: #FFF5E4;--border-radius: var(--ion-border-radius);--padding-start: 14px;margin-top:12px;border:1.5px solid var(--ion-color-primary);box-shadow:0 2px 6px #cd5c0833;transition:box-shadow .3s ease}.editar-perfil-content[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:focus-within{box-shadow:0 0 8px var(--ion-color-primary)}.editar-perfil-content[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-weight:600;color:var(--ion-color-primary)}.editar-perfil-content[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{color:#333}.editar-perfil-content[_ngcontent-%COMP%]   .guardar-btn[_ngcontent-%COMP%]{background:var(--ion-color-primary);color:#fff;font-weight:700;letter-spacing:.8px;box-shadow:0 4px 12px #cd5c0866;transition:background .3s ease}.editar-perfil-content[_ngcontent-%COMP%]   .guardar-btn[_ngcontent-%COMP%]:hover, .editar-perfil-content[_ngcontent-%COMP%]   .guardar-btn[_ngcontent-%COMP%]:focus{background:#b44f07}']});let l=s;return l})();function fe(l,s){if(l&1){let c=U();W(0),i(1,"div",5)(2,"ion-avatar",6),R(3,"img",7),o(),i(4,"h2"),r(5),o(),i(6,"p"),r(7),o()(),i(8,"ion-list",8)(9,"ion-item")(10,"ion-label"),r(11,"Nombre"),o(),i(12,"ion-note",9),r(13),o()(),i(14,"ion-item")(15,"ion-label"),r(16,"Apellido"),o(),i(17,"ion-note",9),r(18),o()(),i(19,"ion-item")(20,"ion-label"),r(21,"Tel\xE9fono"),o(),i(22,"ion-note",9),r(23),o()(),i(24,"ion-item")(25,"ion-label"),r(26,"Email"),o(),i(27,"ion-note",9),r(28),o()()(),i(29,"div",10)(30,"ion-button",11),g("click",function(){_(c);let e=f(2);return b(e.abrirModalEditar())}),r(31," \u270F\uFE0F Editar Perfil "),o(),i(32,"ion-button",12),g("click",function(){_(c);let e=f(2);return b(e.cambiarFotoPerfil())}),r(33," \u{1F4F7} Cambiar Foto "),o(),i(34,"ion-button",13),g("click",function(){_(c);let e=f(2);return b(e.abrirModalPassword())}),r(35," \u{1F512} Cambiar Contrase\xF1a "),o(),i(36,"ion-button",14),g("click",function(){_(c);let e=f(2);return b(e.cerrarSesion())}),r(37," \u{1F6AA} Cerrar Sesi\xF3n "),o()(),H()}if(l&2){let c=f(2);p(3),M("src",c.usuario.imagenUrl||"assets/default-user.jpg",$),p(2),J("",c.usuario.nombre," ",c.usuario.apellido,""),p(2),h(c.usuario.email),p(6),h(c.usuario.nombre),p(5),h(c.usuario.apellido),p(5),h(c.usuario.numero),p(5),h(c.usuario.email)}}function _e(l,s){l&1&&(R(0,"ion-spinner",15),i(1,"p",16),r(2,"Cargando perfil..."),o())}function be(l,s){if(l&1&&(W(0),B(1,fe,38,8,"ng-container",4)(2,_e,3,0,"ng-template",null,1,G),H()),l&2){let c=q(3),t=f();p(),M("ngIf",t.usuario)("ngIfElse",c)}}function he(l,s){if(l&1){let c=U();i(0,"div",17)(1,"h2"),r(2,"Para ver el perfil debes iniciar sesi\xF3n"),o(),i(3,"ion-button",11),g("click",function(){_(c);let e=f();return b(e.goToLogin())}),r(4,"Iniciar sesi\xF3n"),o()()}}var ze=(()=>{let s=class s{constructor(t,e,n,d,a){this.http=t,this.toastCtrl=e,this.navCtrl=n,this.alertCtrl=d,this.modalCtrl=a,this.usuario=null,this.token=localStorage.getItem("token"),this.isLoggedIn=!1}ngOnInit(){this.isLoggedIn=!!this.token,this.isLoggedIn&&this.obtenerPerfil()}obtenerPerfil(){return m(this,null,function*(){let t=new C().set("Authorization",`Bearer ${this.token}`);this.http.get(`${x}/travel/usuarios/perfil`,{headers:t}).subscribe({next:e=>{this.usuario=e.usuario||e},error:e=>{console.error(e),this.presentToast("Error al obtener perfil")}})})}goToLogin(){this.navCtrl.navigateRoot("/login")}cerrarSesion(){return m(this,null,function*(){localStorage.removeItem("token"),this.presentToast("Sesi\xF3n cerrada"),this.navCtrl.navigateRoot("/login")})}cambiarFotoPerfil(){return m(this,null,function*(){let t=document.createElement("input");t.type="file",t.accept="image/*",t.onchange=()=>m(this,null,function*(){let e=t.files?.[0];if(!e)return;let n=new FormData;n.append("imagen",e);let d=new C().set("Authorization",`Bearer ${this.token}`);this.http.put(`${x}/travel/usuarios/actualizar-foto`,n,{headers:d}).subscribe({next:a=>m(this,null,function*(){this.presentToast(a.msg||"Imagen actualizada"),this.obtenerPerfil()}),error:a=>{console.error(a),this.presentToast("Error al actualizar imagen")}})}),t.click()})}abrirModalEditar(){return m(this,null,function*(){let t=yield this.modalCtrl.create({component:me,componentProps:{usuario:this.usuario}});t.onDidDismiss().then(e=>{e.data&&this.obtenerPerfil()}),yield t.present()})}abrirModalPassword(){return m(this,null,function*(){yield(yield this.alertCtrl.create({header:"Cambiar contrase\xF1a",inputs:[{name:"nuevopassword",type:"password",placeholder:"Nueva contrase\xF1a"},{name:"confirmarpassword",type:"password",placeholder:"Confirmar contrase\xF1a"}],buttons:[{text:"Cancelar",role:"cancel"},{text:"Cambiar",handler:e=>this.cambiarPassword(e)}]})).present()})}cambiarPassword(t){let{nuevopassword:e,confirmarpassword:n}=t;if(!e||!n||e!==n){this.presentToast("Las contrase\xF1as no coinciden");return}let d={id:this.usuario?._id,nuevopassword:e,confirmarpassword:n};this.http.post(`${x}/travel/usuarios/actualizar-password`,d).subscribe({next:a=>m(this,null,function*(){this.presentToast("Contrase\xF1a actualizada correctamente")}),error:a=>{console.error(a),this.presentToast("Error al actualizar contrase\xF1a")}})}presentToast(t){return m(this,null,function*(){(yield this.toastCtrl.create({message:t,duration:3e3,position:"bottom"})).present()})}};s.\u0275fac=function(e){return new(e||s)(u(S),u(N),u(ne),u(de),u(A))},s.\u0275cmp=P({type:s,selectors:[["app-perfil"]],standalone:!0,features:[y],decls:8,vars:2,consts:[["guestView",""],["cargando",""],["color","primary"],[1,"ion-padding"],[4,"ngIf","ngIfElse"],[1,"perfil-header","ion-text-center"],[1,"avatar-perfil"],["alt","Foto de perfil",3,"src"],["lines","inset"],["slot","end"],[1,"ion-margin-top"],["expand","block","color","primary",3,"click"],["expand","block","fill","outline","color","medium",3,"click"],["expand","block","fill","outline","color","warning",3,"click"],["expand","block","color","danger",3,"click"],["name","crescent",1,"ion-margin-top"],[1,"ion-text-center"],[1,"ion-text-center","ion-padding"]],template:function(e,n){if(e&1&&(i(0,"ion-header")(1,"ion-toolbar",2)(2,"ion-title"),r(3,"Mi Perfil"),o()()(),i(4,"ion-content",3),B(5,be,4,2,"ng-container",4)(6,he,5,0,"ng-template",null,0,G),o()),e&2){let d=q(7);p(5),M("ngIf",n.isLoggedIn)("ngIfElse",d)}},dependencies:[j,oe,O,T,F,D,z,le,se,ce,V,L,E,K,k],styles:["ion-content[_ngcontent-%COMP%]{--background: #FFF5E4;padding:16px}.perfil-header[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin-bottom:24px;text-align:center}.perfil-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:22px;color:var(--ion-color-primary);margin-top:12px;margin-bottom:4px}.perfil-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;color:#666}.avatar-perfil[_ngcontent-%COMP%]{width:120px;height:120px;border-radius:50%;overflow:hidden;border:4px solid var(--ion-color-primary);box-shadow:0 4px 10px #00000026}.avatar-perfil[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}ion-list[_ngcontent-%COMP%]{margin-top:16px}ion-item[_ngcontent-%COMP%]{--background: #f9f9f9;border-radius:12px;margin-bottom:12px;border:1px solid #ddd;padding:10px 14px}ion-label[_ngcontent-%COMP%]{font-weight:600;color:var(--ion-color-primary)}ion-note[_ngcontent-%COMP%]{font-size:14px;color:#444}ion-button[_ngcontent-%COMP%]{--border-radius: 14px;font-weight:600;letter-spacing:.4px;margin-top:14px;font-size:15px}ion-button[color=primary][_ngcontent-%COMP%]{--background: var(--ion-color-primary);--background-hover: #b44f07}ion-button[color=danger][_ngcontent-%COMP%]{--background: #eb445a}ion-button[color=warning][_ngcontent-%COMP%]{--background: #ffc409;--color: #333}ion-button[fill=outline][_ngcontent-%COMP%]{--border-color: var(--ion-color-primary)}ion-spinner[_ngcontent-%COMP%]{display:block;margin:30px auto 10px}p.ion-text-center[_ngcontent-%COMP%]{font-size:14px;color:#777;margin-top:8px}.ion-text-center[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:18px;color:#444;margin-bottom:16px}"]});let l=s;return l})();export{ze as PerfilPage};
