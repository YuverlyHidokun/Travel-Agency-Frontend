import{B as y,E as S}from"./chunk-6XGMAUUD.js";import"./chunk-NODAZ5ET.js";import"./chunk-QUJFQN2Y.js";import"./chunk-U2EW7UUI.js";import"./chunk-3VGDWX6T.js";import"./chunk-TPX2NT44.js";import"./chunk-PESUVOSL.js";import{B as ue,C as ve,b as X,c as Z,d as ee,e as te,f as ne,g as re,h as ie,i as ae,j as oe,k as se,l as le,m as ce,n as pe,q as de,r as me,s as _e,z as ge}from"./chunk-H73HDHKZ.js";import{a as x}from"./chunk-BZW6RTSU.js";import{$ as w,Aa as G,D as v,Ea as Q,F as g,G as i,H as a,J as F,K as q,M as R,N as b,O as p,V as k,W as s,X as O,Y as h,_ as P,aa as E,ba as z,ca as D,ga as B,ha as L,ia as V,j,na as $,nb as Y,oa as A,q as m,qa as N,qb as J,r as _,ra as W,sa as I,ua as H,xa as U,y as l,yb as K,z as u,zb as M}from"./chunk-Q3SEP6DO.js";import"./chunk-SC7NNYP7.js";import"./chunk-7KGURMOZ.js";import"./chunk-O2LKDVXV.js";import"./chunk-UVK64YLH.js";import"./chunk-6IHAYORV.js";import"./chunk-3OY46VXU.js";import"./chunk-BD6LD5VO.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-YP6DMM4G.js";import"./chunk-CKP3SGE2.js";import"./chunk-HS6F7JI3.js";import"./chunk-NQVRKVPL.js";import"./chunk-NTF5CPGF.js";import"./chunk-DLTAMAIO.js";import"./chunk-K6FI7DQH.js";import"./chunk-TLQMGTG2.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-2YSZFPCQ.js";import"./chunk-57YRIO75.js";import"./chunk-LRFGNCHE.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{e as C}from"./chunk-FP7EQKGB.js";function he(o,c){if(o&1){let r=R();i(0,"ion-item")(1,"ion-label")(2,"h2"),s(3),a(),i(4,"p"),s(5),B(6,"date"),a(),i(7,"p"),s(8),a(),i(9,"p"),s(10," Estado: "),i(11,"ion-badge",8),s(12),a()()(),i(13,"ion-buttons",9)(14,"ion-button",10),b("click",function(){let e=m(r).$implicit,n=p(3);return _(n.editarReserva(e))}),s(15,"Editar"),a(),i(16,"ion-button",11),b("click",function(){let e=m(r).$implicit,n=p(3);return _(n.confirmarEliminar(e))}),s(17,"Eliminar"),a()()()}if(o&2){let r=c.$implicit;l(3),O(r.paquete.nombre),l(2),h("Fecha: ",L(6,5,r.fechaViaje),""),l(3),h("Pasajeros: ",r.pasajeros,""),l(3),g("color",r.estado==="confirmada"?"success":r.estado==="pendiente"?"warning":"danger"),l(),h(" ",r.estado," ")}}function xe(o,c){if(o&1&&(i(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),s(3,"Reservas Actuales"),a()(),i(4,"ion-card-content")(5,"ion-list"),v(6,he,18,7,"ion-item",7),a()()()),o&2){let r=p(2);l(6),g("ngForOf",r.reservas)}}function fe(o,c){o&1&&(i(0,"ion-text",12)(1,"p",13),s(2,"No tienes reservas registradas."),a()())}function Ce(o,c){if(o&1&&(i(0,"ion-select-option",19),s(1),a()),o&2){let r=c.$implicit;g("value",r._id),l(),h(" ",r.nombre," ")}}function be(o,c){if(o&1){let r=R();i(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),s(3,"Nueva Reserva"),a()(),i(4,"ion-card-content")(5,"ion-item")(6,"ion-label"),s(7,"Paquete"),a(),i(8,"ion-select",14),E("ngModelChange",function(e){m(r);let n=p(2);return w(n.nuevaReserva.paqueteId,e)||(n.nuevaReserva.paqueteId=e),_(e)}),v(9,Ce,2,2,"ion-select-option",15),a()(),i(10,"ion-item")(11,"ion-label",16),s(12,"Fecha de viaje"),a(),i(13,"ion-datetime",17),E("ngModelChange",function(e){m(r);let n=p(2);return w(n.nuevaReserva.fechaViaje,e)||(n.nuevaReserva.fechaViaje=e),_(e)}),a()(),i(14,"ion-item")(15,"ion-label",16),s(16,"Pasajeros"),a(),i(17,"ion-input",18),E("ngModelChange",function(e){m(r);let n=p(2);return w(n.nuevaReserva.pasajeros,e)||(n.nuevaReserva.pasajeros=e),_(e)}),a()(),i(18,"ion-button",5),b("click",function(){m(r);let e=p(2);return _(e.crearReserva())}),s(19,"Reservar"),a()()()}if(o&2){let r=p(2);l(8),P("ngModel",r.nuevaReserva.paqueteId),l(),g("ngForOf",r.paquetesDisponibles),l(4),P("ngModel",r.nuevaReserva.fechaViaje),l(4),P("ngModel",r.nuevaReserva.pasajeros)}}function Ie(o,c){if(o&1){let r=R();F(0),v(1,xe,7,1,"ion-card",4)(2,fe,3,0,"ng-template",null,1,V),i(4,"ion-button",5),b("click",function(){m(r);let e=p();return _(e.mostrarFormularioCrear=!e.mostrarFormularioCrear)}),s(5),a(),v(6,be,20,4,"ion-card",6),q()}if(o&2){let r=k(3),t=p();l(),g("ngIf",t.reservas.length>0)("ngIfElse",r),l(4),h(" ",t.mostrarFormularioCrear?"Cancelar":"Crear Nueva Reserva"," "),l(),g("ngIf",t.mostrarFormularioCrear)}}function Re(o,c){o&1&&(i(0,"div",13)(1,"h2"),s(2,"Debes iniciar sesi\xF3n para ver tus reservas"),a(),i(3,"ion-button",20),s(4,"Iniciar sesi\xF3n"),a()())}var ze=(()=>{let c=class c{constructor(t,e,n,d,f){this.http=t,this.toastCtrl=e,this.navCtrl=n,this.alertCtrl=d,this.route=f,this.reservas=[],this.paquetesDisponibles=[],this.mostrarFormularioCrear=!1,this.isLoggedIn=!1,this.token=localStorage.getItem("token"),this.nuevaReserva={paqueteId:"",pasajeros:1,fechaViaje:""},this.loading=!1}ngOnInit(){this.isLoggedIn=!!this.token;let t=this.route.snapshot.queryParamMap.get("paqueteId");t&&(this.nuevaReserva.paqueteId=t,this.mostrarFormularioCrear=!0,this.presentToast("Paquete seleccionado, completa los datos para reservar")),this.cargarReservas(),this.cargarPaquetes()}cargarReservas(){let t=localStorage.getItem("token");if(!t)return;let e=new I().set("Authorization",`Bearer ${t}`);this.http.get(`${x}/travel/reservas/mis-reservas`,{headers:e}).subscribe({next:n=>this.reservas=n,error:n=>this.presentToast("Error al cargar tus reservas")})}cargarPaquetes(){this.http.get(`${x}/travel/paquetes/`).subscribe({next:t=>this.paquetesDisponibles=t,error:()=>this.presentToast("Error al cargar paquetes")})}crearReserva(){return C(this,null,function*(){let{paqueteId:t,fechaViaje:e,pasajeros:n}=this.nuevaReserva;if(!t||!e||n<1){this.presentToast("Completa todos los campos para reservar");return}this.loading=!0;let d=localStorage.getItem("token");if(!d){this.presentToast("Debes iniciar sesi\xF3n para reservar"),this.loading=!1;return}let f=new I().set("Authorization",`Bearer ${d}`),T={paquete:t,pasajeros:n,fechaViaje:e};this.http.post(`${x}/travel/reservas/`,T,{headers:f}).subscribe({next:()=>{this.loading=!1,this.presentToast("Reserva creada con \xE9xito"),this.mostrarFormularioCrear=!1,this.nuevaReserva={paqueteId:"",pasajeros:1,fechaViaje:""},this.cargarReservas()},error:()=>{this.loading=!1,this.presentToast("Error al crear la reserva")}})})}editarReserva(t){return C(this,null,function*(){yield(yield this.alertCtrl.create({header:"Editar Reserva",inputs:[{name:"pasajeros",type:"number",min:1,value:t.pasajeros,placeholder:"Pasajeros"},{name:"fechaViaje",type:"date",value:t.fechaViaje?t.fechaViaje.split("T")[0]:"",placeholder:"Fecha de viaje"}],buttons:[{text:"Cancelar",role:"cancel"},{text:"Guardar",handler:n=>{this.actualizarReserva(t._id,n.pasajeros,n.fechaViaje)}}]})).present()})}actualizarReserva(t,e,n){if(!e||e<1||!n){this.presentToast("Datos inv\xE1lidos para actualizar");return}let d=localStorage.getItem("token");if(!d){this.presentToast("Debes iniciar sesi\xF3n para actualizar");return}let f=new I().set("Authorization",`Bearer ${d}`),T={pasajeros:e,fechaViaje:n};this.http.put(`${x}/travel/reservas/${t}`,T,{headers:f}).subscribe({next:()=>{this.presentToast("Reserva actualizada"),this.cargarReservas()},error:()=>this.presentToast("Error al actualizar reserva")})}confirmarEliminar(t){return C(this,null,function*(){yield(yield this.alertCtrl.create({header:"Confirmar eliminaci\xF3n",message:`\xBFQuieres eliminar la reserva para ${t.paquete.nombre}?`,buttons:[{text:"Cancelar",role:"cancel"},{text:"Eliminar",role:"destructive",handler:()=>this.eliminarReserva(t._id)}]})).present()})}eliminarReserva(t){let e=localStorage.getItem("token");if(!e){this.presentToast("Debes iniciar sesi\xF3n para eliminar");return}let n=new I().set("Authorization",`Bearer ${e}`);this.http.delete(`${x}/travel/reservas/${t}`,{headers:n}).subscribe({next:()=>{this.presentToast("Reserva eliminada"),this.cargarReservas()},error:()=>this.presentToast("Error al eliminar reserva")})}presentToast(t){return C(this,null,function*(){(yield this.toastCtrl.create({message:t,duration:3e3,position:"bottom"})).present()})}};c.\u0275fac=function(e){return new(e||c)(u(H),u(S),u(M),u(y),u(U))},c.\u0275cmp=j({type:c,selectors:[["app-reservas"]],standalone:!0,features:[z([S,y,M]),D],decls:8,vars:2,consts:[["guestView",""],["noReservas",""],["color","primary"],[1,"ion-padding"],[4,"ngIf","ngIfElse"],["expand","block",3,"click"],[4,"ngIf"],[4,"ngFor","ngForOf"],[3,"color"],["slot","end"],["size","small","color","primary",3,"click"],["size","small","color","danger",3,"click"],["color","medium"],[1,"ion-text-center"],["placeholder","Selecciona un paquete",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["position","stacked"],["presentation","date",3,"ngModelChange","ngModel"],["type","number","min","1",3,"ngModelChange","ngModel"],[3,"value"],["expand","block","routerLink","/login","color","primary"]],template:function(e,n){if(e&1&&(i(0,"ion-header")(1,"ion-toolbar",2)(2,"ion-title"),s(3,"Mis Reservas"),a()()(),i(4,"ion-content",3),v(5,Ie,7,4,"ng-container",4)(6,Re,5,0,"ng-template",null,0,V),a()),e&2){let d=k(7);l(5),g("ngIf",n.token)("ngIfElse",d)}},dependencies:[W,$,A,N,K,Y,J,Q,G,oe,_e,me,ae,te,re,ne,ie,ce,se,le,ue,ve,pe,Z,ee,X,de,ge],styles:['@charset "UTF-8";ion-content[_ngcontent-%COMP%]{--background: #FFF5E4;padding:16px}ion-card[_ngcontent-%COMP%]{border-radius:16px;box-shadow:0 4px 14px #00000014;margin-bottom:24px;overflow:hidden;background:#fff;transition:transform .2s ease}ion-card[_ngcontent-%COMP%]:hover{transform:translateY(-3px)}ion-card-title[_ngcontent-%COMP%]{font-size:20px;font-weight:700;color:var(--ion-color-primary)}ion-item[_ngcontent-%COMP%]{--background: #f9f9f9;border-radius:12px;margin-top:12px;border:1px solid #ddd;align-items:flex-start;padding:12px}ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:16px;font-weight:600;color:var(--ion-color-primary);margin-bottom:4px}ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:4px 0;font-size:14px;color:#444}ion-badge[_ngcontent-%COMP%]{font-size:13px;text-transform:capitalize;padding:4px 10px;border-radius:8px}ion-buttons[_ngcontent-%COMP%]{display:flex;gap:8px;margin-left:8px}ion-button[_ngcontent-%COMP%]{--border-radius: 14px;font-weight:600;font-size:14px;letter-spacing:.3px}ion-button[expand=block][_ngcontent-%COMP%]{margin-top:20px}ion-text[_ngcontent-%COMP%]{font-size:16px;color:#666}.ion-text-center[_ngcontent-%COMP%]{margin-top:80px;padding:0 24px}.ion-text-center[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:20px;color:#444;margin-bottom:16px}']});let o=c;return o})();export{ze as ReservasPage};
